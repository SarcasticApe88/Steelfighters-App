<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Steelfighters</title>

  <!-- iOS/PWA basics -->
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Steelfighters">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-180.png">
  <link rel="manifest" href="manifest.json">

  <style>
    :root { --bg:#111; --fg:#fff; --muted:#bbb; --card:#222; --accent:#1877f2; --ok:#16a34a; --bad:#dc2626; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:var(--bg); color:var(--fg) }

    /* Header */
    header{ position:sticky; top:0; z-index:5; background:#000; display:grid; grid-template-columns:48px 1fr 120px; align-items:center; gap:6px; padding:10px 8px; }
    .h-btn{ display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:10px; background:#1a1a1a; cursor:pointer; user-select:none; }
    .h-title{ text-align:center; font-weight:700; }
    .h-right{ text-align:right; }
    .btn{ background:var(--accent); color:#fff; border:none; padding:10px 12px; border-radius:10px; cursor:pointer; }
    .ghost{ background:#1f2937; border:1px solid #374151; }

    /* Views */
    .content{ display:none; padding:18px; }
    .content.show{ display:block; }
    .list{ display:flex; flex-direction:column; gap:12px; align-items:center; }
    .item{ background:var(--card); width:100%; max-width:420px; padding:16px; border-radius:14px; text-align:center; font-size:16px; cursor:pointer; }
    .back{ display:inline-block; margin-bottom:10px; cursor:pointer; color:var(--muted) }

    /* Training: Double */
    .bar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:10px 0 14px }
    select, input[type=number]{ background:#181818; color:#fff; border:1px solid #333; border-radius:10px; padding:10px; }
    .stat{ display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin:8px 0 14px }
    .stat .box{ background:#0f172a; border:1px solid #1f2937; padding:10px; border-radius:12px; text-align:center; }
    .pad{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:8px; }
    .hit{ background:var(--ok); color:#fff; font-size:18px; padding:24px 14px; border-radius:16px; border:none; }
    .miss{ background:var(--bad); color:#fff; font-size:18px; padding:24px 14px; border-radius:16px; border:none; }
    .undo{ background:#374151; color:#fff; border:none; padding:10px 12px; border-radius:10px; }
    .note{ color:var(--muted); font-size:13px; }

    /* iFrame wrapper */
    .iframe-wrap{ margin-top:10px; border:1px solid #333; border-radius:12px; overflow:hidden; }
    .iframe-wrap iframe{ width:100%; height:70vh; border:0; background:#000; }
    a.ext{ color:#9cf }
  </style>
</head>
<body>

<header>
  <!-- links: Menü-Icon öffnet immer das Hauptmenü -->
  <div class="h-btn" id="menuBtn" title="Menü">☰</div>

  <!-- Mitte: Titel -->
  <div class="h-title">Steelfighters</div>

  <!-- rechts: Aktualisieren -->
  <div class="h-right">
    <button class="btn" id="refreshBtn">Aktualisieren</button>
  </div>
</header>

<!-- HOME -->
<div id="home" class="content show">
  <div class="list">
    <div class="item" onclick="showView('news')">News</div>
    <div class="item" onclick="showView('teamA')">Steelfighters A</div>
    <div class="item" onclick="showView('teamB')">Steelfighters B</div>
    <div class="item" onclick="showView('training')">Training</div>
    <div class="item" onclick="showView('settings')">Einstellungen</div>
  </div>
</div>

<!-- NEWS -->
<div id="news" class="content">
  <div class="back" onclick="showView('home')">← Zurück</div>
  <div id="news_list"><p class="note">Keine News geladen.</p></div>
</div>

<!-- TEAM A -->
<div id="teamA" class="content">
  <div class="back" onclick="showView('home')">← Zurück</div>
  <div class="list">
    <div class="item" onclick="showView('teamA_tabelle')">Tabelle</div>
    <div class="item" onclick="showView('teamA_spieltage_kader')">Spieltage & Kader</div>
    <div class="item" onclick="showView('teamA_gegner')">Gegner</div>
  </div>
</div>
<div id="teamA_tabelle" class="content">
  <div class="back" onclick="showView('teamA')">← Zurück</div>
  <div class="iframe-wrap">
    <iframe src="https://2k-dart-software.com/frontend/events/10/event/233/table" referrerpolicy="no-referrer"></iframe>
  </div>
  <p><a class="ext" href="https://2k-dart-software.com/frontend/events/10/event/233/table" target="_blank">Im Browser öffnen</a></p>
</div>
<div id="teamA_spieltage_kader" class="content">
  <div class="back" onclick="showView('teamA')">← Zurück</div>
  <div class="iframe-wrap">
    <iframe src="https://2k-dart-software.com/frontend/events/10/event/233/participants/7574" referrerpolicy="no-referrer"></iframe>
  </div>
  <p><a class="ext" href="https://2k-dart-software.com/frontend/events/10/event/233/participants/7574" target="_blank">Im Browser öffnen</a></p>
</div>
<div id="teamA_gegner" class="content">
  <div class="back" onclick="showView('teamA')">← Zurück</div>
  <div class="iframe-wrap">
    <iframe src="https://2k-dart-software.com/frontend/events/10/event/233/participants" referrerpolicy="no-referrer"></iframe>
  </div>
  <p><a class="ext" href="https://2k-dart-software.com/frontend/events/10/event/233/participants" target="_blank">Im Browser öffnen</a></p>
</div>

<!-- TEAM B -->
<div id="teamB" class="content">
  <div class="back" onclick="showView('home')">← Zurück</div>
  <div class="list">
    <div class="item" onclick="showView('teamB_tabelle')">Tabelle</div>
    <div class="item" onclick="showView('teamB_spieltage_kader')">Spieltage & Kader</div>
    <div class="item" onclick="showView('teamB_gegner')">Gegner</div>
  </div>
</div>
<div id="teamB_tabelle" class="content">
  <div class="back" onclick="showView('teamB')">← Zurück</div>
  <div class="iframe-wrap">
    <iframe src="https://2k-dart-software.com/frontend/events/10/event/244/table" referrerpolicy="no-referrer"></iframe>
  </div>
  <p><a class="ext" href="https://2k-dart-software.com/frontend/events/10/event/244/table" target="_blank">Im Browser öffnen</a></p>
</div>
<div id="teamB_spieltage_kader" class="content">
  <div class="back" onclick="showView('teamB')">← Zurück</div>
  <div class="iframe-wrap">
    <iframe src="https://2k-dart-software.com/frontend/events/10/event/244/participants/5385" referrerpolicy="no-referrer"></iframe>
  </div>
  <p><a class="ext" href="https://2k-dart-software.com/frontend/events/10/event/244/participants/5385" target="_blank">Im Browser öffnen</a></p>
</div>
<div id="teamB_gegner" class="content">
  <div class="back" onclick="showView('teamB')">← Zurück</div>
  <div class="iframe-wrap">
    <iframe src="https://2k-dart-software.com/frontend/events/10/event/244/participants" referrerpolicy="no-referrer"></iframe>
  </div>
  <p><a class="ext" href="https://2k-dart-software.com/frontend/events/10/event/244/participants" target="_blank">Im Browser öffnen</a></p>
</div>

<!-- TRAINING -->
<div id="training" class="content">
  <div class="back" onclick="showView('home')">← Zurück</div>
  <div class="list">
    <div class="item" onclick="showView('train_double')">Double-Training</div>
    <div class="item" onclick="alert('Scoring (Einzelzahl) – folgt')">Scoring (Einzelzahl)</div>
    <div class="item" onclick="alert('Scoring (frei) – folgt')">Scoring (frei)</div>
    <div class="item" onclick="alert('Checkout – folgt')">Checkout 41–170</div>
    <div class="item" onclick="alert('Around the Clock – folgt')">Around the Clock</div>
  </div>
</div>

<!-- TRAINING: DOUBLE -->
<div id="train_double" class="content">
  <div class="back" onclick="showView('training')">← Zurück</div>

  <div class="bar">
    <label>Ziel-Double:&nbsp;
      <select id="dbl_target">
        <option value="D20">D20</option>
        <option value="D16">D16</option>
        <option value="D12">D12</option>
        <option value="D10">D10</option>
        <option value="D8">D8</option>
        <option value="D6">D6</option>
        <option value="D4">D4</option>
        <option value="D2">D2</option>
        <option value="DBull">D-Bull</option>
        <option value="(frei)">(frei)</option>
      </select>
    </label>

    <label>Darts:&nbsp;
      <select id="dbl_darts">
        <option value="30">30</option>
        <option value="60">60</option>
        <option value="90">90</option>
      </select>
    </label>

    <button class="btn" id="dbl_start">Start</button>
    <button class="ghost" id="dbl_reset">Reset</button>
  </div>

  <div class="stat">
    <div class="box"><div class="note">Verbleibend</div><div id="dbl_left" style="font-weight:700">0</div></div>
    <div class="box"><div class="note">Treffer</div><div id="dbl_hits" style="font-weight:700">0</div></div>
    <div class="box"><div class="note">Fehler</div><div id="dbl_miss" style="font-weight:700">0</div></div>
    <div class="box"><div class="note">Quote</div><div id="dbl_rate" style="font-weight:700">0%</div></div>
  </div>

  <div class="pad">
    <button class="hit" id="dbl_btn_hit">HIT</button>
    <button class="miss" id="dbl_btn_miss">MISS</button>
  </div>

  <div style="display:flex;gap:8px; margin-top:12px">
    <button class="undo" id="dbl_undo">Undo</button>
    <button class="ghost" id="dbl_save">Session speichern</button>
  </div>

  <p class="note" id="dbl_status">Bereit.</p>
</div>

<!-- EINSTELLUNGEN (nur JSON-Links; simpel) -->
<div id="settings" class="content">
  <div class="back" onclick="showView('home')">← Zurück</div>
  <p class="note">Hier kannst du die Remote-Quellen eintragen (optional). Wenn leer, bleiben die eingebauten Links aktiv.</p>
  <div class="list" style="align-items:stretch">
    <div class="item" style="cursor:default">
      <label>Config JSON URL</label>
      <input id="cfg_url" type="url" placeholder="https://.../config.json" style="width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#181818;color:#fff">
      <label>News JSON URL</label>
      <input id="news_url" type="url" placeholder="https://.../news.json" style="width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#181818;color:#fff">
      <div style="height:10px"></div>
      <button class="btn" id="save_urls">Speichern</button>
    </div>
  </div>
</div>

<script>
/* ---------- Navigation ---------- */
function showView(id){
  document.querySelectorAll('.content').forEach(e=>e.classList.remove('show'));
  document.getElementById(id).classList.add('show');
}
document.getElementById('menuBtn').onclick = ()=> showView('home');

/* ---------- Remote (optional) ---------- */
const CFG_KEY='sf_cfg_urls_v1', DATA_KEY='sf_cached_data_v1';
let CFG = JSON.parse(localStorage.getItem(CFG_KEY) || '{"configUrl":"","newsUrl":""}');
let DATA = JSON.parse(localStorage.getItem(DATA_KEY) || '{"config":null,"news":null,"ts":0}');
function saveCfg(){ localStorage.setItem(CFG_KEY, JSON.stringify(CFG)); }
function saveData(){ localStorage.setItem(DATA_KEY, JSON.stringify(DATA)); }
async function fetchJSON(url){ const r = await fetch(url, {cache:'no-store'}); if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); }
async function loadRemote(){
  try{
    if(CFG.configUrl){ DATA.config = await fetchJSON(CFG.configUrl); }
    if(CFG.newsUrl){ DATA.news = await fetchJSON(CFG.newsUrl); }
    DATA.ts = Date.now(); saveData();
    applyConfig(); renderNews();
    alert('Aktualisiert.');
  }catch(e){ alert('Fehler beim Laden: '+e.message); }
}
function applyConfig(){
  const c = DATA.config; if(!c || !c.teams) return;
  if(c.teams.A){
    if(c.teams.A.table) document.querySelector('#teamA_tabelle iframe').src = c.teams.A.table;
    if(c.teams.A.gamesAndRoster) document.querySelector('#teamA_spieltage_kader iframe').src = c.teams.A.gamesAndRoster;
    if(c.teams.A.participants) document.querySelector('#teamA_gegner iframe').src = c.teams.A.participants;
  }
  if(c.teams.B){
    if(c.teams.B.table) document.querySelector('#teamB_tabelle iframe').src = c.teams.B.table;
    if(c.teams.B.gamesAndRoster) document.querySelector('#teamB_spieltage_kader iframe').src = c.teams.B.gamesAndRoster;
    if(c.teams.B.participants) document.querySelector('#teamB_gegner iframe').src = c.teams.B.participants;
  }
}
function renderNews(){
  const wrap = document.getElementById('news_list'); if(!wrap) return;
  const items = (DATA.news || []);
  if(!items.length){ wrap.innerHTML = '<p class="note">Keine News geladen.</p>'; return; }
  items.sort((a,b)=> (b.date||'').localeCompare(a.date||''));
  wrap.innerHTML = items.map(n=>`
    <div class="item" style="max-width:none;text-align:left">
      <div style="opacity:.8;font-size:12px">${n.date||''}</div>
      <div style="font-weight:700;margin:4px 0">${n.title||''}</div>
      <div>${(n.body||'').replace(/\\n/g,'<br>')}</div>
    </div>`).join('');
}
document.getElementById('refreshBtn').onclick = loadRemote;
window.addEventListener('DOMContentLoaded', ()=>{
  const cu = document.getElementById('cfg_url'), nu = document.getElementById('news_url');
  if(cu) cu.value = CFG.configUrl||''; if(nu) nu.value = CFG.newsUrl||'';
  const s = document.getElementById('save_urls');
  if(s) s.onclick = ()=>{ CFG.configUrl = cu.value.trim(); CFG.newsUrl = nu.value.trim(); saveCfg(); alert('URLs gespeichert'); };
  applyConfig(); renderNews();
});

/* ---------- Double Training Logic ---------- */
const storeKey='darts_trainer_store_v1';
function loadStore(){ try{ return JSON.parse(localStorage.getItem(storeKey) || '{}'); }catch{ return {}; } }
function saveStore(v){ localStorage.setItem(storeKey, JSON.stringify(v)); }

let dbl = { total:0, left:0, hits:0, miss:0, history:[], target:'D20' };
function updateUI(){
  document.getElementById('dbl_left').textContent = dbl.left;
  document.getElementById('dbl_hits').textContent = dbl.hits;
  document.getElementById('dbl_miss').textContent = dbl.miss;
  const rate = dbl.total ? Math.round(dbl.hits/dbl.total*100) : 0;
  document.getElementById('dbl_rate').textContent = rate + '%';
  document.getElementById('dbl_status').textContent =
    dbl.total? `Ziel ${dbl.target} • ${dbl.total-dbl.left+1}./${dbl.total}` : 'Bereit.';
}
function startDouble(){
  const darts = parseInt(document.getElementById('dbl_darts').value,10);
  const target = document.getElementById('dbl_target').value;
  dbl = { total:darts, left:darts, hits:0, miss:0, history:[], target };
  updateUI();
}
function press(hit){
  if(dbl.left<=0) return;
  dbl.history.push(hit?'H':'M');
  hit ? dbl.hits++ : dbl.miss++;
  dbl.left--;
  updateUI();
}
function undo(){
  const last = dbl.history.pop(); if(!last) return;
  last==='H'? dbl.hits-- : dbl.miss--;
  dbl.left++;
  updateUI();
}
function resetDouble(){
  dbl = { total:0,left:0,hits:0,miss:0,history:[],target:'D20' };
  updateUI();
}
function saveSession(){
  if(dbl.total===0) return alert('Keine Session gestartet.');
  const rate = dbl.total ? Math.round(dbl.hits/dbl.total*100) : 0;
  const st = loadStore();
  st.doubleSessions = st.doubleSessions || [];
  st.doubleSessions.push({
    ts: Date.now(), target: dbl.target, darts: dbl.total,
    hits: dbl.hits, miss: dbl.miss, rate
  });
  saveStore(st);
  alert('Session gespeichert.');
}

document.getElementById('dbl_start').onclick = startDouble;
document.getElementById('dbl_btn_hit').onclick = ()=>press(true);
document.getElementById('dbl_btn_miss').onclick = ()=>press(false);
document.getElementById('dbl_undo').onclick = undo;
document.getElementById('dbl_reset').onclick = resetDouble;
document.getElementById('dbl_save').onclick = saveSession;
updateUI();

/* PWA SW */
if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js')); }
</script>
  <footer style="text-align:center;color:#666;font-size:12px;margin-top:20px">
  Build v5 – Stand: 19.09.2025
  </footer>
</body>

</html>
